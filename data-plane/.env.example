# Data Plane Environment Configuration
# Copy to .env and customize

# =============================================================================
# Operation Mode
# =============================================================================
# standalone: No control plane, use static config only (no auditing)
# connected:  Use control plane API, fall back to static config
DATAPLANE_MODE=connected

# =============================================================================
# Control Plane Connection (used in 'connected' mode)
# =============================================================================
# API token for authenticating with control plane
# Generate with: openssl rand -hex 32
# Used by: Envoy (credentials/rate-limits), agent-manager (heartbeat)
CONTROL_PLANE_TOKEN=

# Control plane API URL
# Set to control plane machine's IP/hostname
# Example: http://192.168.1.50:8002
CONTROL_PLANE_URL=

# Agent manager heartbeat interval (seconds)
HEARTBEAT_INTERVAL=30

# Agent ID (for multi-agent deployments)
AGENT_ID=default

# =============================================================================
# OpenObserve Connection (for auditing profile)
# =============================================================================
# Vector pushes logs directly to OpenObserve (not via CP API)
# Required when using --profile auditing
# Set to control plane machine's IP/hostname
OPENOBSERVE_HOST=
OPENOBSERVE_PORT=5080
OPENOBSERVE_USER=admin@maltbox.local
OPENOBSERVE_PASSWORD=admin

# =============================================================================
# Static Configuration (used in standalone mode or as fallback)
# =============================================================================
# You can either:
#   1. Edit configs/static-config.yaml and run: eval $(scripts/load-static-config.sh --export)
#   2. Set these variables directly below
#
# To load from YAML:
#   source scripts/load-static-config.sh
#   docker-compose up -d

# Credentials for automatic header injection (standalone mode)
# Format: domain:header_name:header_value[:alias]
#   - alias is optional; if set, alias.devbox.local resolves to domain
# Examples:
#   api.openai.com:Authorization:Bearer sk-xxx:openai
#     -> openai.devbox.local resolves to api.openai.com with credential
#   api.github.com:Authorization:token ghp_xxx
#     -> no alias, direct domain match only
# Separate multiple entries with |
# WARNING: Avoid committing real secrets to version control
STATIC_CREDENTIALS=

# Rate limits per domain
# Format: domain:rpm:burst,domain:rpm:burst
# Example: api.openai.com:60:10,api.github.com:100:20,default:120:20
STATIC_RATE_LIMITS=default:120:20

# =============================================================================
# Container Security
# =============================================================================
# Container runtime: runc (default) or runsc (gVisor)
# gVisor provides kernel-level isolation - syscalls never reach host kernel
# Highly recommended for running untrusted code
#
# To use gVisor:
#   1. Install: https://gvisor.dev/docs/user_guide/install/
#   2. Configure Docker: sudo runsc install && sudo systemctl restart docker
#   3. Set: CONTAINER_RUNTIME=runsc
CONTAINER_RUNTIME=runc

# =============================================================================
# Agent Configuration
# =============================================================================
# Build variant: lean, dev, or ml
# lean: Essentials only (~1.5GB)
# dev:  Essentials + Go + Rust + AWS CLI (~3GB)
# ml:   Dev + PyTorch + ML libs (~6GB)
AGENT_VARIANT=lean

AGENT_CONTAINER_NAME=agent
AGENT_WORKSPACE_VOLUME=data-plane_agent-workspace

# SSH public key for agent access (paste your id_rsa.pub content here)
# Example: ssh-rsa AAAAB3NzaC1yc2EAAAA... user@host
SSH_AUTHORIZED_KEYS=

# =============================================================================
# FRP Configuration (for SSH access via --profile ssh)
# =============================================================================
# FRP server address (control plane host)
FRP_SERVER_ADDR=
# FRP server port (default: 7000)
FRP_SERVER_PORT=7000
# Authentication token (must match control plane frps.toml)
FRP_AUTH_TOKEN=
# Remote port for SSH tunnel (unique per agent, e.g., 6000, 6001, 6002...)
FRP_REMOTE_PORT=6000

# =============================================================================
# Environment
# =============================================================================
ENVIRONMENT=development
